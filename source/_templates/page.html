{% extends "!page.html" %}
{{ super() }}

{% block extrahead %}=
<!-- Google Tag Manager -->
<script>
(function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
    var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
})(window, document, "script", "dataLayer", "GTM-WC8V9XS");
</script>
<!-- End Google Tag Manager -->
<!-- UnionAI docs variant switcher -->
<script>
function getAvailableVariants() {
    var div = document.getElementById('unionai-docs-available-variants');
    var content = div.textContent || div.innerText;
    var array;
    try {
        array = JSON.parse(content);
    } catch (e) {
        console.error('Error parsing content to array:', e);
        return null;
    }
    if (Array.isArray(array) && array.every(item => typeof item === 'string')) {
        return array;
    } else {
        console.error('Parsed content is not an array of strings');
        return null;
    }
}

function getVariantDisplayNames() {
    var div = document.getElementById('unionai-docs-variant-display-names');
    var content = div.textContent || div.innerText;
    var displayNames;
    try {
        displayNames = JSON.parse(content);
    } catch (e) {
        console.error('Error parsing content to array:', e);
        return null;
    }
    return displayNames;
}

document.addEventListener("DOMContentLoaded", function() {
    var variants = getAvailableVariants();
    var variantDisplayNames = getVariantDisplayNames();

    // Get the current page URL
    var currentUrl = new URL(window.location.href);

    // Extract the path segments
    var pathSegments = currentUrl.pathname.split('/').filter(Boolean);

    // Find the index of the path segment that matches one of the variants
    var matchedIndex = -1;
    for (var i = 0; i < pathSegments.length; i++) {
        if (variants.includes(pathSegments[i])) {
            matchedIndex = i;
            break;
        }
    }

    // If a matching path segment is found
    if (matchedIndex !== -1) {
        // Create the list container
        var list = [];

        // Iterate over the variants array
        variants.forEach(function(variant) {
            // Create a new URL with the matched path segment replaced by the variant
            var newUrl = new URL(currentUrl);
            var newPathSegments = pathSegments.slice();
            newPathSegments[matchedIndex] = variant;
            newUrl.pathname = '/' + newPathSegments.join('/');

            // Create the list item and anchor elements
            var listItem = {};
            listItem.text = variantDisplayNames[variant];
            listItem.url = newUrl.href;
            list.push(listItem);
        });

        const dropdownLinks = document.getElementById('dropdown-links');
        list.forEach(link => {
            const anchor = document.createElement('a');
            anchor.href = link.url;
            anchor.textContent = link.text;
            dropdownLinks.appendChild(anchor);
        });
    }

    const dropdownTextContainer = document.getElementById('dropdown-text');
    const dropdownLinks = document.getElementById('dropdown-links');
    const dropdownItems = dropdownLinks.getElementsByTagName('a');

    for (let i = 0; i < dropdownItems.length; i++) {
        dropdownItems[i].addEventListener('click', function (event) {
            event.preventDefault();
            const selectedItemText = this.getAttribute('');
            dropdownTextContainer.textContent = selectedItemText;
        });
    }
})

document.addEventListener('DOMContentLoaded', function () {
    const dropdownButton = document.getElementById('dropdownButton');
    const dropdownMenu = document.getElementById('dropdownMenu');
    const dropdownItems = dropdownMenu.getElementsByTagName('a');

    for (let i = 0; i < dropdownItems.length; i++) {
        dropdownItems[i].addEventListener('click', function (event) {
            event.preventDefault();
            dropdownButton.textContent = this.textContent;
        });
    }
});

</script>
<!-- End UnionAI docs variant switcher -->
{% endblock %}

{% block body %}
{%- if meta is mapping %}
    <div id="unionai-docs-variant-display-names" style="display: none;">{{ meta.get("variant-display-names") }}</div>
    <div id="unionai-docs-available-variants" style="display: none;">{{ meta.get("available-variants") }}</div>
    <div id="unionai-docs-this-variant" style="display: none;">{{ meta.get("this-variant") }}</div>
{%- endif %}
{{ super() }}

<!-- Google Tag Manager (noscript) -->
<noscript
  ><iframe
    src="https://www.googletagmanager.com/ns.html?id=GTM-WC8V9XS"
    height="0"
    width="0"
    style="display: none; visibility: hidden"
  ></iframe
></noscript>
<!-- End Google Tag Manager (noscript) -->
{% endblock %}
