{{- $pages := .Site.RegularPages -}}
{{- $pages = where $pages "Type" "!=" "page" -}}
{{- $pages = where $pages "Params.noindex" "!=" true -}}
{{- $pages = where $pages "Params.hidden" "!=" true -}}
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
        xmlns:xhtml="http://www.w3.org/1999/xhtml">
  {{- range $pages -}}
  <url>
    <loc>{{ .Permalink | absURL }}</loc>
    {{- if .Lastmod -}}
    <lastmod>{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}</lastmod>
    {{- else if .Date -}}
    <lastmod>{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}</lastmod>
    {{- end -}}
    <changefreq>{{ if .Params.changefreq }}{{ .Params.changefreq }}{{ else }}monthly{{ end }}</changefreq>
    <priority>{{ if .Params.priority }}{{ .Params.priority }}{{ else }}{{ if eq .Kind "home" }}1.0{{ else if eq .Kind "section" }}0.8{{ else }}0.6{{ end }}{{ end }}</priority>
  </url>
  {{- end -}}
</urlset>
